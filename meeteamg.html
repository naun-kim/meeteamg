<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>팀 미팅 시간 계산기</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#111827; --muted:#6b7280; --line:#e5e7eb; --brand:#2563eb; --brand-weak:#dbeafe;
      --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --chip:#f3f4f6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;background:var(--bg);color:var(--fg)}
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:10}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:0 0 6px}
    .sub{color:var(--muted);font-size:13px}
    .row{display:flex;gap:16px;align-items:stretch}
    .col{background:#fff;border:1px solid var(--line);border-radius:12px; padding:16px}
    .col.left{flex:0 0 300px}
    .col.right{flex:1}
    .section-title{font-weight:600;margin:8px 0 10px}
    input[type="text"], select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;font-size:14px}
    button{border:1px solid var(--line);background:#fff;border-radius:10px;padding:10px 12px;font-size:14px;cursor:pointer}
    button.brand{background:var(--brand);border-color:var(--brand);color:#fff}
    button.ghost{background:#fff}
    button:disabled{opacity:0.5;cursor:not-allowed}
    .btn-row{display:flex;gap:8px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:var(--chip);border:1px solid var(--line);border-radius:999px;margin:4px 4px 0 0}
    .pill .x{background:#fff;border:1px solid var(--line);border-radius:50%;width:18px;height:18px;display:grid;place-items:center;cursor:pointer}
    .muted{color:var(--muted)}

    /* Day tabs */
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .tab{padding:8px 12px;border:1px solid var(--line);border-radius:999px;cursor:pointer;background:#fff}
    .tab.active{background:#fff;border-color:var(--brand);color:var(--brand);box-shadow:0 0 0 3px var(--brand-weak) inset}

    /* Grid */
    .grid{overflow:auto;border:1px solid var(--line);border-radius:12px}
    table{border-collapse:separate;border-spacing:0;width:100%;min-width:720px}
    thead th{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:5}
    th, td{border-right:1px solid var(--line); border-bottom:1px solid var(--line); padding:0;font-size:13px;text-align:center}
    th:first-child, td:first-child{position:sticky;left:0;background:#fff;border-right:1px solid var(--line);text-align:left;z-index:4;padding:8px 10px}
    tr:last-child td{border-bottom:none}
    th:last-child, td:last-child{border-right:none}
    .cell{display:block;width:100%;height:28px;user-select:none;border-radius:4px;margin:0px;padding:4px;transition:background .08s ease;cursor:pointer;box-sizing:border-box;}
    /* 한 시간 칸(td) 내부를 좌/우 2칸으로 쪼개기 */
    .half-wrap{display:grid;grid-template-columns: 1fr 1fr;gap:2px;padding:4px;box-sizing:border-box;}
    .half-cell{height:28px;border-radius:4px;cursor:pointer;user-select:none;box-sizing:border-box;padding:2px;}

    .busy{background:#fee2e2}
    .free{background:#ecfdf5}
    .hint{font-size:12px;color:var(--muted)}

    /* Summary */
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .card{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;max-height:200px;overflow:auto}
    .badge{display:inline-block;background:var(--brand-weak);border:1px solid var(--brand);color:var(--brand);padding:2px 8px;border-radius:999px;font-size:12px}
    .slot-chip{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:4px 8px;margin:4px 6px 0 0;cursor:pointer}

    footer{margin:24px 0;color:var(--muted);font-size:12px}
    .hr{height:1px;background:var(--line);margin:12px 0}

    @media (max-width: 880px){
      .row{flex-direction:column}
      .col.left{flex:1}
    }

/* --- 헤더(1행) 중앙정렬 & 첫열(A열) 폭 최적화 --- */
/* 헤더셀은 중앙 정렬 */
thead th{text-align:center;height:28px;line-height:28px;}

/* A1 포함, 헤더의 첫 셀도 중앙정렬 */
thead th:first-child{text-align:center;}
/* 본문(이름 열)은 가운데 정렬 유지 + 폭 슬림 */
tbody th:first-child{text-align:center;}
/* 첫 열(이름/시간) 폭 줄이기: 너무 길지 않게 */
th:first-child, td:first-child{width:120px;min-width:120px;max-width:200px;white-space:nowrap;word-break:keep-all;overflow:hidden;text-overflow:ellipsis;}

/* 60분 칸엔 흰 여백을 주고, 30분(half-wrap 있는 칸)은 유지 */
.grid td { padding: 2px; box-sizing: border-box; }     /* ← 60분 칸에 흰 틈 생김 */
.grid td:has(.half-wrap) { padding: 0; }               /* ← 30분 칸(반칸)은 기존처럼 */

/* =======================
   Hover 효과 (PC용)
   ======================= */
.cell:hover,
.half-cell:hover{outline: 2px solid #2563eb;outline-offset: -2px;}
/* =======================
   모바일 대응 (화면 폭 600px 이하)
   ======================= */
@media (max-width: 600px){
  th:first-child,
  td:first-child{width: 90px;min-width: 90px;font-size: 12px;}
  thead th{font-size: 11px;}

  .cell, .half-cell{height: 24px;padding: 2px;}
}

  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>팀 미팅 시간 계산기</h1>
      <div class="sub">사람별로 <b>수업/불가 시간</b>을 체크하면, 각 시간대의 <b>참여 가능 인원</b>을 집계하고 <b>최다/과반</b> 슬롯을 찾아줍니다. (라이트 테마)</div>
    </div>
  </header>

  <main class="wrap" id="app">
    <div class="row">
      <!-- LEFT: Participants & Settings -->
      <div class="col left">
        <div class="section-title">1) 참여자</div>
        <form class="btn-row" id="addForm" autocomplete="off">
          <input id="nameInput" type="text" placeholder="이름 입력 후 추가 (엔터)" />
          <button type="submit" class="brand" id="addBtn">추가</button>
        </form>
        <div id="people" style="margin-top:8px"></div>
        <div class="hr"></div>

        <div class="section-title">2) 기준 시간</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <label class="hint">시작
            <select id="startSelect"></select>
          </label>
          <label class="hint">종료
            <select id="endSelect"></select>
          </label>
          <label class="hint">간격
            <select id="stepSelect">
              <option value="60">60분</option>
              <option value="30">30분</option>
            </select>
          </label>
          <label class="hint">요일
            <select id="daysSelect" multiple size="6" style="height:110px">
              <option value="Mon" selected>Mon</option>
              <option value="Tue" selected>Tue</option>
              <option value="Wed" selected>Wed</option>
              <option value="Thu" selected>Thu</option>
              <option value="Fri" selected>Fri</option>
              <option value="Sat">Sat</option>
              <option value="Sun">Sun</option>
            </select>
          </label>
        </div>
        <div class="btn-row" style="margin-top:8px">
          <button id="applyTime">적용</button>
          <button id="clearAll">전체 초기화</button>
        </div>

        <p class="hint">드래그하거나 'crtl+클릭' 하여 <br>원하는 요일을 설정하세요.</p>

        <div class="hr"></div>

        <div class="section-title">3) 저장/불러오기 (현재 미지원) </div>
        <div class="btn-row">
          <button id="saveJson">JSON 저장</button>
          <input type="file" id="loadJson" accept="application/json" />
        </div>
        <p class="hint">브라우저 <b>자동 임시 저장</b> (localStorage)도 됩니다.</p>
 
        <div class="hr"></div>

        <div class="section-title">4) 미팅 시간 계산하기</div>
        <div class="btn-row">
          <button class="brand" id="previewImage">이미지 미리보기 → 저장</button>
        </div>
        <div style="margin-top:4px;">
          <label class="sub" style="display:flex;align-items:center;gap:6px;cursor:pointer;">
            <input type="checkbox" id="showRecommend" style="margin:0;"> 추천 시간대 표시
          </label>
        </div>
        
        <p class="hint">버튼을 누르면 미리보기 페이지로 이동하고,<br> 거기서 JPG로 저장할 수 있어요.</p>

      </div>

      <!-- RIGHT: Scheduler -->
      <div class="col right">
        <div class="tabs" id="dayTabs"></div>
        <div class="grid" id="gridWrap"></div>
        <div class="hr"></div>

        <div class="section-title">요약</div>
        <div class="cards">
          <div class="card">
            <div class="badge">최다 인원</div>
            <div id="topSlots" style="margin-top:8px"></div>
          </div>
          <div class="card">
            <div class="badge">과반 이상</div>
            <div id="majoritySlots" style="margin-top:8px"></div>
          </div>
          <div class="card">
            <div class="badge">모두 참석 가능</div>
            <div id="allSlots" style="margin-top:8px"></div>
          </div>
          <div class="card">
            <div class="badge">슬롯 클릭 시</div>
            <div id="slotDetail" class="muted" style="margin-top:8px">그 시간에 가능한 사람 목록을 보여줍니다.</div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      ⓘ 셀을 클릭하면 <b>불가 시간</b>으로 토글됩니다(붉은색=불가, 초록=가능). 드래그로 여러 셀을 한번에 표시할 수 있어요. © 2025 by Naun
    </footer>
  </main>

  <!-- html2canvas 추가 (DOM을 캔버스로 캡쳐) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
(() => {
  const state = {
    participants: [],
    busy: {},
    days: ['Mon','Tue','Wed','Thu','Fri'],
    start: '09:00',
    end:   '21:00',
    step: 60,
    activeDay: 'Mon',
    dragging:false,
    dragMode:null,
    lastApplied:null,
    clickGuard:false
  };

  const toMin = (hhmm) => { const [h,m] = hhmm.split(':').map(Number); return h*60+m; };
  const toHHMM = (m) => `${String(Math.floor(m/60)).padStart(2,'0')}:${String(m%60).padStart(2,'0')}`;
  const slotId = (day, hhmm) => `${day}-${hhmm}`;
  const buildSlots = () => {
    const slots=[]; const s=toMin(state.start), e=toMin(state.end);
    for(const d of state.days){ for(let t=s;t<e;t+=state.step){ slots.push({day:d,time:toHHMM(t)}) } }
    return slots;
  };

  // DOM refs
  const addForm = document.getElementById('addForm');
  const nameInput = document.getElementById('nameInput');
  const peopleWrap = document.getElementById('people');
  const startSel = document.getElementById('startSelect');
  const endSel = document.getElementById('endSelect');
  const stepSel = document.getElementById('stepSelect');
  const daysSel = document.getElementById('daysSelect');
  const dayTabs = document.getElementById('dayTabs');
  const gridWrap = document.getElementById('gridWrap');
  const topSlotsDiv = document.getElementById('topSlots');
  const majoritySlotsDiv = document.getElementById('majoritySlots');
  const slotDetail = document.getElementById('slotDetail');

  // time options
  (function buildTimeOptions(){
    const times=[]; for(let m=0;m<1440;m+=30) times.push(toHHMM(m));
    startSel.innerHTML = times.map(t=>`<option ${t==='09:00'?'selected':''}>${t}</option>`).join('');
    endSel.innerHTML = times.map(t=>`<option ${t==='21:00'?'selected':''}>${t}</option>`).join('');
  })();

  // IME-safe
  let composing=false; nameInput.addEventListener('compositionstart',()=>composing=true); nameInput.addEventListener('compositionend',()=>composing=false);

  // People
  function renderPeople(){
    if(!state.participants.length){ peopleWrap.innerHTML = '<p class="hint">아직 아무도 없어요. 이름을 추가해 주세요.</p>'; return; }
    peopleWrap.innerHTML = state.participants.map(p=>`<div class="pill" data-id="${p.id}"><span>${p.name}</span><span class="x" title="삭제">×</span></div>`).join('');
  }
  peopleWrap.addEventListener('click', (e)=>{
    const x = e.target.closest('.x'); if(!x) return;
    const id = x.parentElement.getAttribute('data-id');
    state.participants = state.participants.filter(pp=>pp.id!==id); delete state.busy[id];
    persist(); renderAll();
  });

  function addPerson(raw){ const name=(raw||'').trim(); if(!name) return; const id=(crypto?.randomUUID?.()||Math.random().toString(36).slice(2)); state.participants.push({id,name}); state.busy[id]=new Set(); persist(); renderAll(); }
  addForm.addEventListener('submit', (e)=>{ e.preventDefault(); if(composing) return; addPerson(nameInput.value); nameInput.value=''; });

  // Tabs
  function renderDayTabs(){ dayTabs.innerHTML = state.days.map(d=>`<div class="tab ${d===state.activeDay?'active':''}" data-day="${d}">${d}</div>`).join(''); }
  dayTabs.addEventListener('click', (e)=>{ const t=e.target.closest('.tab'); if(!t) return; state.activeDay = t.getAttribute('data-day'); renderDayTabs(); renderGrid(); });

  // Grid
  function renderGrid(){
  const s = toMin(state.start), e = toMin(state.end);
  const step = state.step;
  const d = state.activeDay;

  // ① 헤더(시간 라벨)는 항상 "1시간" 간격으로
  const hours = [];
  for (let t = s; t < e; t += 60) hours.push(toHHMM(t));

  // ② 본문 테이블 시작
  let html = '<table><thead><tr><th>이름 / 시간</th>'
           + hours.map(t => `<th>${t}</th>`).join('')
           + '</tr></thead><tbody>';

  if (!state.participants.length){
    html += `<tr><td colspan="${hours.length+1}" class="muted" style="padding:12px">참여자를 먼저 추가하세요.</td></tr>`;
  } else {
    for (const p of state.participants){
      html += `<tr data-id="${p.id}"><th title="${p.name}">${p.name}</th>`;

      for (let h = s; h < e; h += 60){
        const hLabel = toHHMM(h);

        if (step === 30){
          // ③ 30분 간격: 한 시간 칸을 좌/우 2칸으로 쪼개서 data-slot을 2개 배치
          const leftTime  = hLabel;                // 예: 09:00
          const rightTime = toHHMM(h + 30);        // 예: 09:30 (마지막 시간 넘어가면 자연히 다음시간으로 계산)

          const leftId  = slotId(d, leftTime);
          const rightId = (h + 30 < e) ? slotId(d, rightTime) : null;

          const leftBusy  = state.busy[p.id]?.has(leftId);
          const rightBusy = rightId ? state.busy[p.id]?.has(rightId) : false;

          html += `<td>
            <div class="half-wrap">
              <div class="half-cell ${leftBusy?'busy':'free'}"  data-slot="${leftId}"></div>
              ${
                rightId
                  ? `<div class="half-cell ${rightBusy?'busy':'free'}" data-slot="${rightId}"></div>`
                  : `<div class="half-cell" style="opacity:.3;pointer-events:none"></div>`
              }
            </div>
          </td>`;
        } else {
          // ④ 60분 간격: 기존처럼 한 칸에 하나의 .cell
          const id = slotId(d, hLabel);
          const busy = state.busy[p.id]?.has(id);
          html += `<td><div class="cell ${busy?'busy':'free'}" data-slot="${id}"></div></td>`;
        }
      }
      html += '</tr>';
    }
  }

  html += '</tbody></table>';
  gridWrap.innerHTML = html;

  renderSummary();
}


  // Interaction
  function getPidFromCell(el){ const tr = el.closest('tr[data-id]'); return tr? tr.getAttribute('data-id') : null; }
  function applyCell(pid, id, makeBusy){ if(!state.busy[pid]) state.busy[pid]=new Set(); if(makeBusy) state.busy[pid].add(id); else state.busy[pid].delete(id); }

  gridWrap.addEventListener('mousedown', (e)=>{
    const cell = e.target.closest('[data-slot]'); if(!cell) return;
    e.preventDefault();
    const pid = getPidFromCell(cell); const id = cell.getAttribute('data-slot'); if(!pid||!id) return;

    const isBusy = state.busy[pid]?.has(id);
    state.dragging=true; state.dragMode = !isBusy; state.lastApplied=null;

    applyCell(pid, id, state.dragMode); state.lastApplied = pid+id; updateCellVisual(pid, id); persist();
    state.clickGuard = true;
  });

  gridWrap.addEventListener('mousemove', (e)=>{
    if(!state.dragging) return; const cell = e.target.closest('[data-slot]'); if(!cell) return;
    const pid = getPidFromCell(cell); const id = cell.getAttribute('data-slot'); if(!pid||!id) return;
    const key = pid+id; if(key===state.lastApplied) return; applyCell(pid, id, state.dragMode); state.lastApplied=key; updateCellVisual(pid,id); persist();
  });

  gridWrap.addEventListener('click', (e)=>{
    const cell = e.target.closest('.cell'); if(!cell) return;
    if(state.clickGuard){ state.clickGuard=false; return; }
    if(state.dragging) return;
  });

  window.addEventListener('mouseup', ()=>{ if(state.dragging){ state.dragging=false; state.dragMode=null; state.lastApplied=null; renderSummary(); } });

  function updateCellVisual(pid,id){ const selector = `tr[data-id="${CSS.escape(pid)}"] [data-slot="${CSS.escape(id)}"]`; const el = gridWrap.querySelector(selector); if(!el) return; const makeBusy = state.busy[pid]?.has(id); el.classList.toggle('busy', makeBusy); el.classList.toggle('free', !makeBusy); }

  // Summary
  function computeStats(){
    const total = state.participants.length; const slots=buildSlots(); const map=new Map();
    for(const s of slots){ const id=slotId(s.day,s.time); let free=0; const freeList=[]; for(const p of state.participants){ const b=state.busy[p.id]||new Set(); if(!b.has(id)){ free++; freeList.push(p.name);} } map.set(id,{free,freeList}); }
    const arr=[...map.entries()].map(([id,v])=>({id,...v}));
    const max = arr.reduce((m,x)=>Math.max(m,x.free),0);
    const top = arr.filter(x=>x.free===max && max>0).sort((a,b)=>a.id.localeCompare(b.id));
    const minMajor=Math.ceil((total||1)/2+1);
    const majority=arr.filter(x=>x.free>=minMajor).sort((a,b)=> (b.free-a.free) || a.id.localeCompare(b.id));
    const all = total>0 ? arr.filter(x=>x.free===total).sort((a,b)=>a.id.localeCompare(b.id)) : [];
    return {total,top,majority,all,map};
  }

  function renderSummary(){ const {total,top,majority,all,map}=computeStats();
    const chip = (id)=>{ const [d,t]=id.split('-'); const f=(map.get(id)?.free)||0; return `<span class="slot-chip" data-slot="${id}">${d} ${t} · ${f}/${total}</span>`; };
    topSlotsDiv.innerHTML = top.length? top.map(x=>chip(x.id)).join('') : '<span class="muted">표시할 슬롯이 없습니다.</span>';
    majoritySlotsDiv.innerHTML = majority.length? majority.map(x=>chip(x.id)).join('') : '<span class="muted">과반 이상 슬롯 없음</span>';
    const allDiv = document.getElementById('allSlots');
    if(allDiv){ allDiv.innerHTML = all.length? all.map(x=>chip(x.id)).join('') : '<span class="muted">전원 가능 없음</span>'; }
  }

  function handleSummaryClick(e){ const chip=e.target.closest('.slot-chip[data-slot]'); if(!chip) return; const id=chip.getAttribute('data-slot'); const [d,t]=id.split('-');
    state.activeDay=d; renderDayTabs(); renderGrid();
    const {map,total}=computeStats(); const info=map.get(id)||{free:0,freeList:[]}; slotDetail.innerHTML = `<b>${d} ${t}</b> (${info.free}/${total})<br>` + (info.freeList.length? info.freeList.map(n=>`<span class='slot-chip'>${n}</span>`).join(''):'<span class="muted">없음</span>');
  }
  document.getElementById('topSlots').addEventListener('click', handleSummaryClick);
  document.getElementById('majoritySlots').addEventListener('click', handleSummaryClick);
  const allEl = document.getElementById('allSlots'); if(allEl){ allEl.addEventListener('click', handleSummaryClick); }

  // Settings
  document.getElementById('applyTime').addEventListener('click', ()=>{
    const sel=[...daysSel.options].filter(o=>o.selected).map(o=>o.value); if(!sel.length){ alert('요일을 1개 이상 선택하세요.'); return; }
    const s=startSel.value, e=endSel.value, st=parseInt(stepSel.value,10); if(toMin(s)>=toMin(e)){ alert('시작 시간이 종료 시간보다 빨라야 합니다.'); return; }
    state.days=sel; state.start=s; state.end=e; state.step=st; if(!state.days.includes(state.activeDay)) state.activeDay=state.days[0]; persist(); renderAll();
  });
  document.getElementById('clearAll').addEventListener('click', ()=>{ if(!confirm('모든 체크를 지우고 초기화할까요?')) return; for(const p of state.participants){ state.busy[p.id]=new Set(); } persist(); renderGrid(); });

  // Save/Load
  const saveBtn=document.getElementById('saveJson'); const loadInput=document.getElementById('loadJson');
  const exportData = ()=>({ participants: state.participants, busy:Object.fromEntries(Object.entries(state.busy).map(([k,v])=>[k,[...v]])), days:state.days, start:state.start, end:state.end, step:state.step, brand: (document.getElementById('brandText')?.value || '').trim(), brandLink: (document.getElementById('brandLink')?.value || '').trim()});
  const importData = (data)=>{ state.participants=Array.isArray(data.participants)?data.participants:[]; state.busy={}; for(const p of state.participants){ state.busy[p.id]=new Set(); } if(data.busy){ for(const [k,arr] of Object.entries(data.busy)){ state.busy[k]=new Set(arr); } } state.days=data.days||state.days; state.start=data.start||state.start; state.end=data.end||state.end; state.step=data.step||state.step; if(!state.days.includes(state.activeDay)) state.activeDay=state.days[0]; };
  saveBtn.addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(exportData(),null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='meeting_scheduler_data.json'; a.click(); URL.revokeObjectURL(a.href); });
  loadInput.addEventListener('change', async (e)=>{ const f=e.target.files?.[0]; if(!f) return; try{ const data=JSON.parse(await f.text()); importData(data); persist(); renderAll(); }catch{ alert('불러오기 실패: 올바른 JSON이 아닙니다.'); }});

  // storage
  const persist = ()=>{ try{ localStorage.setItem('meeting_scheduler_mvp', JSON.stringify(exportData())); }catch{} };
  const restore = ()=>{ try{ const raw=localStorage.getItem('meeting_scheduler_mvp'); if(raw) importData(JSON.parse(raw)); }catch{} };

  function renderAll(){ startSel.value=state.start; endSel.value=state.end; stepSel.value=String(state.step); [...daysSel.options].forEach(o=>o.selected=state.days.includes(o.value)); renderPeople(); renderDayTabs(); renderGrid(); }

  restore(); renderAll();

  try{
  const raw = localStorage.getItem('meeting_scheduler_mvp');
  if(raw){
    const d = JSON.parse(raw);
    if(document.getElementById('brandText')) document.getElementById('brandText').value = d.brand || '';
    if(document.getElementById('brandLink')) document.getElementById('brandLink').value = d.brandLink || '';
  }
}catch{}


  /* =========================
     ▼ 이미지 미리보기 로직 ▼
     ========================= */
  document.getElementById('previewImage').addEventListener('click', async ()=>{
    // 1) 캡쳐용 임시 DOM 만들기 (표 + 요약)
    const captureArea = document.createElement('div');
    captureArea.style.padding = '12px';
    captureArea.style.background = '#ffffff';
    captureArea.style.width = '1100px';

    // 제목
    const title = document.createElement('div');
    title.innerHTML = `
      <div style="font-weight:700;font-size:18px;margin-bottom:4px;">팀 미팅 시간표 (미리보기)</div>
      <div style="color:#6b7280;font-size:12px;margin-bottom:10px;">${new Date().toLocaleString()}</div>
    `;
    captureArea.appendChild(title);

    // 현재 보이는 그리드 복제
    const gridClone = document.getElementById('gridWrap').cloneNode(true);
    gridClone.style.marginBottom = '10px';
    captureArea.appendChild(gridClone);

    // 요약 카드 묶음
    const summaryWrap = document.createElement('div');
    summaryWrap.style.display = 'grid';
    summaryWrap.style.gridTemplateColumns = 'repeat(auto-fit,minmax(220px,1fr))';
    summaryWrap.style.gap = '12px';

    const blocks = [
      ['최다 인원', document.getElementById('topSlots').innerHTML],
      ['과반 이상', document.getElementById('majoritySlots').innerHTML],
      ['모두 참석 가능', document.getElementById('allSlots')?.innerHTML || ''],
    ];

    for (const [label, html] of blocks) {
      const card = document.createElement('div');
      card.style.border = '1px solid #e5e7eb';
      card.style.borderRadius = '12px';
      card.style.padding = '12px';
      card.innerHTML = `
        <div style="display:inline-block;background:#dbeafe;border:1px solid #2563eb;color:#2563eb;padding:2px 8px;border-radius:999px;font-size:12px">${label}</div>
        <div style="margin-top:8px">${html || '<span style="color:#6b7280">없음</span>'}</div>
      `;
      summaryWrap.appendChild(card);
    }
    captureArea.appendChild(summaryWrap);

    document.body.appendChild(captureArea);

    // 2) 캔버스로 캡쳐 (고해상도)
    const scale = Math.max(3, window.devicePixelRatio || 1);
    const canvas = await html2canvas(captureArea, { backgroundColor:'#ffffff', scale });

    // 임시 DOM 제거
    document.body.removeChild(captureArea);

    // 3) dataURL 저장 후 preview.html로 이동
    const dataURL = canvas.toDataURL('image/jpeg', 0.92);
    try {
      localStorage.setItem('meeting_scheduler_preview_jpg', dataURL);
      const rec = document.getElementById('showRecommend').checked ? '1' : '0';
      window.location.href = 'preview.html?rec=' + rec;
    } catch (e) {
      alert('이미지 데이터 저장공간이 부족해요. 표 범위를 줄이거나 브라우저 저장공간을 비워주세요.');
    }
  });
})();
</script>
</body>
</html>

